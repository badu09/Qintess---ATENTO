@isTest
private class TestBOProdutosAlelo {

    static testMethod void myUnitTest() {
    	String opportunitiesJson = '{"E_mail_Enviado__c":false, "Name": "TESTE_11H - DATA CLOUD SISTEMAS DE INFORMATICA LTDA", "StageName": "Apresentação Enviada", "CloseDate": "2016-09-30","Produtos_Alelo__r":{"totalSize":5,"done":true,"records":[{"Name":"Cultura","Nome_do_Produto__c":"Cultura","Quantidade_de_Cartoes__c":10,"Entrega_Centralizada__c":false,"Disponibilizacao_mensal__c":50,"Codigo_de_Produtos__c":"400","Valor_Unitario__c":50,"Faturamento_Centralizado__c":false},{"Name":"Não Identificado","Nome_do_Produto__c":"Não Identificado","Quantidade_de_Cartoes__c":10,"Entrega_Centralizada__c":false,"Disponibilizacao_mensal__c":50,"Codigo_de_Produtos__c":"302","Valor_Unitario__c":50,"Faturamento_Centralizado__c":false},{"Name":"Cultura","Nome_do_Produto__c":"Cultura","Quantidade_de_Cartoes__c":10,"Entrega_Centralizada__c":false,"Disponibilizacao_mensal__c":50,"Codigo_de_Produtos__c":"400","Valor_Unitario__c":50,"Faturamento_Centralizado__c":false},{"Name":"Auto","Nome_do_Produto__c":"Auto","Quantidade_de_Cartoes__c":4,"Entrega_Centralizada__c":false,"Disponibilizacao_mensal__c":1500,"Codigo_de_Produtos__c":"301","Valor_Unitario__c":1500,"Faturamento_Centralizado__c":false},{"Name":"Flex Car Visa Vale","Nome_do_Produto__c":"Flex Car Visa Vale","Quantidade_de_Cartoes__c":5,"Entrega_Centralizada__c":false,"Disponibilizacao_mensal__c":1500,"Codigo_de_Produtos__c":"300","Valor_Unitario__c":1500,"Faturamento_Centralizado__c":false}]},"Account":{"Name":"DATA CLOUD SISTEMAS DE INFORMATICA LTDA","CPF_CNPJ__c":"18146085000186"}}';
    	Opportunity oportunidade = (Opportunity) JSON.deserialize(opportunitiesJson, Opportunity.class);
    	insert oportunidade.Account;
    	oportunidade.AccountId = oportunidade.Account.Id;
    	insert oportunidade;
    	for(Produtos_Alelo__c produto : oportunidade.Produtos_Alelo__r) {
    		produto.Oportunidade__c = oportunidade.Id;
    	}
    	insert oportunidade.Produtos_Alelo__r;
    	Test.startTest();
    	Map<String, String> mapMock = new Map<String, String>();
    	mapMock.put('acessarMaintainContractIS', '<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"><S:Body><ns2:acessarMaintainContractISResponse xmlns:ns2="http://impl.middleware.alelo.atento.com.br/"><return><contractList><address><addressType>LEGAL</addressType><cityName>RIO DE JANEIRO</cityName><complement>SALA 1026</complement><countryISOCode>BR</countryISOCode><countryName>Brasil</countryName><doorNumber>190</doorNumber><neighbourhood>BOTAFOGO</neighbourhood><postalCode>22270012</postalCode><stateISOCode>RJ</stateISOCode><street>RUA VOLUNTARIOS DA PATRIA</street></address><adjustmentIndexCode>IPCA</adjustmentIndexCode><averageMonthlyIndividualBenefitValue>374</averageMonthlyIndividualBenefitValue><bankBillingBankCode>237</bankBillingBankCode><billingBranchCNPJ>19072920000143</billingBranchCNPJ><branchCountPrevision>1</branchCountPrevision><canUsersAskCardAndPassword>false</canUsersAskCardAndPassword><cnaeClassificationDivision>2</cnaeClassificationDivision><cnaeClassificationSection>A</cnaeClassificationSection><commercialAreaCBSSCode>0000000001</commercialAreaCBSSCode><companyType>1</companyType><complementaryData/><contractFee><advantageMonthQuantity>0</advantageMonthQuantity><advantagePercentage>0</advantagePercentage><discountMonthQuantity>2</discountMonthQuantity><exemptMonthQuantity>1</exemptMonthQuantity><feeCode>4</feeCode><feePercentage>0</feePercentage><unitaryFeeAmount>10</unitaryFeeAmount></contractFee><contractFee><advantageMonthQuantity>0</advantageMonthQuantity><advantagePercentage>0</advantagePercentage><discountMonthQuantity>2</discountMonthQuantity><exemptMonthQuantity>1</exemptMonthQuantity><feeCode>5</feeCode><feePercentage>0</feePercentage><unitaryFeeAmount>10</unitaryFeeAmount></contractFee><contractFee><advantageMonthQuantity>0</advantageMonthQuantity><advantagePercentage>0</advantagePercentage><discountMonthQuantity>2</discountMonthQuantity><exemptMonthQuantity>1</exemptMonthQuantity><feeCode>7</feeCode><feePercentage>0</feePercentage><unitaryFeeAmount>10</unitaryFeeAmount></contractFee><contractFee><advantageMonthQuantity>0</advantageMonthQuantity><advantagePercentage>0</advantagePercentage><discountMonthQuantity>2</discountMonthQuantity><exemptMonthQuantity>1</exemptMonthQuantity><feeCode>1</feeCode><feePercentage>0</feePercentage><unitaryFeeAmount>10</unitaryFeeAmount></contractFee><contractFee><advantageMonthQuantity>0</advantageMonthQuantity><advantagePercentage>0</advantagePercentage><discountMonthQuantity>2</discountMonthQuantity><exemptMonthQuantity>1</exemptMonthQuantity><feeCode>14</feeCode><feePercentage>0</feePercentage><unitaryFeeAmount>10</unitaryFeeAmount></contractFee><contractNumber>10818516</contractNumber><contractType>DEFAULT</contractType><contracteeDocumentNumber>19072920000143</contracteeDocumentNumber><contracteeDocumentType>CNPJ</contracteeDocumentType><contracteeLegalName>CONSULTARE ESPACOS MEDICOS LTDA</contracteeLegalName><contracteeMunicipalInscriptionNumber>isento</contracteeMunicipalInscriptionNumber><contracteeStateInscriptionNumber>12345678</contracteeStateInscriptionNumber><controlLevel>BASIC</controlLevel><decisionSpokesman><adress><addressType>LEGAL</addressType><cityName>RIO DE JANEIRO</cityName><complement>SALA 1026</complement><countryISOCode>BR</countryISOCode><countryName>Brasil</countryName><doorNumber>190</doorNumber><neighbourhood>BOTAFOGO</neighbourhood><postalCode>22270012</postalCode><stateISOCode>RJ</stateISOCode><street>RUA VOLUNTARIOS DA PATRIA</street></adress><birthDate>1972-06-27T00:00:00-03:00</birthDate><commercialAdressType>BRANCH</commercialAdressType><companyDocumentNumber>19072920000143</companyDocumentNumber><companyDocumentType>CNPJ</companyDocumentType><documentNumber>04790813606</documentNumber><email>anderson.pires@consultare.net.br</email><gender>MALE</gender><jobType>MANAGER</jobType><localization>DEPTO PESSOAL</localization><phone1><areaCode>21</areaCode><countryCode>55</countryCode><phoneNumber>32395000</phoneNumber><phoneType>PHONE</phoneType></phone1><spokesmanName>Anderson Pires Valgas</spokesmanName></decisionSpokesman><decisionSpokesmanIsCompanyEmployee>true</decisionSpokesmanIsCompanyEmployee><deliveryBranchCNPJ>19072920000143</deliveryBranchCNPJ><embossingCompanyName>SV ECOMM</embossingCompanyName><entryChannelCode>W005</entryChannelCode><fantasyName>CONSULTARE</fantasyName><hasFinancialRestriction>false</hasFinancialRestriction><incentiveProgramInscriptionNumber>1234567891</incentiveProgramInscriptionNumber><individualHomeDelivery>false</individualHomeDelivery><invoiceBranchCNPJ>19072920000143</invoiceBranchCNPJ><isCPFSalesmanCode>false</isCPFSalesmanCode><isDeliveryCentralized>true</isDeliveryCentralized><isElectronicInvoicing>false</isElectronicInvoicing><isInvoiceCentralized>true</isInvoiceCentralized><issuerCode>1</issuerCode><legalName>CONSULTARE ESPACOS MEDICOS LTDA</legalName><marketType>MARKET</marketType><negotiationType>NORMAL_SALE</negotiationType><numberOfEmployees>100</numberOfEmployees><operationSpokesman><adress><addressType>LEGAL</addressType><cityName>RIO DE JANEIRO</cityName><complement>SALA 1026</complement><countryISOCode>BR</countryISOCode><countryName>Brasil</countryName><doorNumber>190</doorNumber><neighbourhood>BOTAFOGO</neighbourhood><postalCode>22270012</postalCode><stateISOCode>RJ</stateISOCode><street>RUA VOLUNTARIOS DA PATRIA</street></adress><birthDate>1972-06-27T00:00:00-03:00</birthDate><commercialAdressType>BRANCH</commercialAdressType><companyDocumentNumber>19072920000143</companyDocumentNumber><companyDocumentType>CNPJ</companyDocumentType><documentNumber>03971454461</documentNumber><email>anderson.pires@consultare.net.br</email><gender>MALE</gender><jobType>MANAGER</jobType><localization>DEPTO PESSOAL</localization><phone1><areaCode>21</areaCode><countryCode>55</countryCode><phoneNumber>32395000</phoneNumber><phoneType>PHONE</phoneType></phone1><spokesmanName>JOAO DA SILVA CARDOSO</spokesmanName></operationSpokesman><operationSpokesmanIsCompanyEmployee>true</operationSpokesmanIsCompanyEmployee><paymentMedia>WEB_TICKET</paymentMedia><paymentType>PREPAID</paymentType><phone1><areaCode>11</areaCode><countryCode>55</countryCode><phoneNumber>21886152</phoneNumber><phoneType>PHONE</phoneType></phone1><productCode>100</productCode><requestChannelCodes>W001</requestChannelCodes><requestsCSVFile>false</requestsCSVFile><saleChannelCode>BANK_AGENCY</saleChannelCode><salesmanCode>001</salesmanCode><salesmanName>ATENTO</salesmanName><salesmanPhoneNumber><areaCode>11</areaCode><countryCode>55</countryCode><phoneNumber>21886152</phoneNumber><phoneType>PHONE</phoneType></salesmanPhoneNumber><signatureDate>2016-09-21T00:00:00-03:00</signatureDate><technologyType>TARJA</technologyType><usageType>CREDIT</usageType><userCountPrevision>100</userCountPrevision><vendorBranchCheckDigit>0</vendorBranchCheckDigit><vendorBranchCode>1</vendorBranchCode><vendorCode>1</vendorCode><vendorType>ORGANIZATION</vendorType><viewAdditionalInfoWEB>false</viewAdditionalInfoWEB><viewFeesWEB>false</viewFeesWEB><yearBillAmount>2000000</yearBillAmount></contractList><responseData><clrs>Atento,5,W005,19282,1,2016-09-21 14:58:41.517954</clrs><communicationData><additionalInformation>Atento</additionalInformation><channel>W005</channel><institution>Atento</institution><product>1</product><usn>19282</usn></communicationData><success>true</success></responseData></return></ns2:acessarMaintainContractISResponse></S:Body></S:Envelope>');
        HttpAcessoExternoMock mock = new HttpAcessoExternoMock(100, '', '', new Map<String, String>());
        mock.setMocks(mapMock);
        Test.setMock(HttpCalloutMock.class, mock);
        BOProdutosAlelo.maitainContractIS(oportunidade.Produtos_Alelo__r[0].Id);
        Test.stopTest();
    }
}